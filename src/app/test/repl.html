<!doctype html>
<html>
<head>
    <title>yasp repl</title>

    <meta charset="utf-8">

    <script src="../../lib/js/jquery-1.10.2.min.js"></script>
    <script src="../js/commands.js"></script>
    <script src="../js/utils.js"></script>
</head>
<body>
<script src="../js/assembler/assembler.js"></script>
<script src="../js/assembler/passes/lexer.js"></script>
<script src="../js/assembler/passes/analyser.js"></script>
<script src="../js/assembler/passes/parser.js"></script>
<script src="../js/assembler/passes/generator.js"></script>
<script src="../js/emulator/bitutils.js"></script>
<script src="../js/emulator/emulator.js"></script>

<script src="./repl.js"></script>

Input: <input id="code" value="MOV b0,b1"><br>
<button id="benchmark">Benchmark</button> => <span id="timeTakenHz">0 Hz</span>
<pre id="bitcode">&nbsp;</pre>
<pre id="mem"></pre>

<script type="text/javascript">
    var repl = new yasp.Repl();

    dumpRam();

    $('#code').bind('keypress', function(e) {
        if(e.keyCode==13){
            var result = repl.execute(getCode());

            dumpRam();

            if(result.error == null) {
                $('#bitcode').text(yasp.Repl.getDumpFromArray(result.bitcode, -1));
            } else {
                var error = getPrettyAsmError(result.error.errors);
                $('#bitcode').text(error);
            }

            clearCode();
        }
    });

    $('#benchmark').click(function (e) {
        $('#timeTakenHz').text("working..");
        setTimeout(function () {
            var result = repl.benchmark(getCode(), 5000000);
            $('#timeTakenHz').text(Math.round(result.hz * 10) / 10 + " Hz");
        }, 0)
    });

    function getPrettyAsmError (errors) {
        var error = "";
        for (var i = 0; i < errors.length; i++) {
            error += errors[i].message.replace('\n', 'â†µ');
        }
        return error;
    }

    function getCode () {
        return $('#code').val();
    }

    function clearCode () {
        $('#code').val("");
    }

    function dumpRam () {
        $('#mem').text(repl.getRamDump());
    }
</script>
</body>
</html>
